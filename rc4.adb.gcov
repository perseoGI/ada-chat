        -:    0:Source:/mnt/c/Users/reiva/source/ada-chat/src/crypto/RC4/rc4.adb
        -:    1:package body RC4 is
        -:    2:   
    #####:    3:   procedure RC4_Swap(This: in out Object; Pos1: Byte; Pos2: Byte) is
        -:    4:      Aux: Byte;
        -:    5:   begin
    #####:    6:      Aux := This.Internal(Pos1);
    #####:    7:      This.Internal(Pos1) := This.Internal(Pos2);
    #####:    8:      This.Internal(Pos2) := Aux;
    #####:    9:   end RC4_Swap;
        -:   10:   
    #####:   11:   procedure RC4_Init(This: in out Object; Key: CharVec) is
    #####:   12:      Aux: Byte := 0;
    #####:   13:      Aux2: Integer := 0;
    #####:   14:      Aux3: Byte := 0;
        -:   15:   begin
        -:   16:      --Init internal state
    #####:   17:      for I in This.Internal'Range loop
    #####:   18:         This.Internal(I) := I;
    #####:   19:      end loop;
        -:   20:   
        -:   21:      --Populate with key internal state
    #####:   22:      for I in This.Internal'Range loop
    #####:   23:         Aux2 := (Integer(I) mod Key'Length)+1;
    #####:   24:         Aux3 := Key(Aux2);
    #####:   25:         Aux := (Aux + Aux3 + This.Internal(I)) mod 255;
    #####:   26:         This.RC4_Swap(Pos1 => I, Pos2 => Aux);   
    #####:   27:      end loop;
    #####:   28:   end RC4_Init;
        -:   29:
    #####:   30:   function RC4_Next(This: in out Object) return Byte is
        -:   31:   begin
    #####:   32:      This.I := (This.I + 1) mod 255;
    #####:   33:      This.J := (This.J + This.Internal(This.I)) mod 255;
    #####:   34:      This.RC4_Swap(Pos1 => This.I, Pos2 => This.J);
    #####:   35:      return This.Internal(This.Internal(This.I)+This.Internal(This.J));
        -:   36:   end RC4_Next;
        -:   37:
        -:   38:end RC4;
